# 実装計画書

## 🎯 プロジェクト概要

**目的**: LT セッション管理機能の追加により、第 ○ 回の LT 大会を体系的に管理する

**主な変更点**:

- 新しい`lt_sessions`テーブルの追加
- `talks`テーブルからの`venue`削除とセッションとの紐付け
- 管理者用セッション管理機能の追加
- スケジュール表示の改善

---

## 📋 実装フェーズ

### **フェーズ 1: データベース設計と基盤整備**

**期間**: 1 週間
**担当**: バックエンド

#### 作業内容

- [ ] `lt_sessions`テーブルの設計確定
- [ ] Drizzle ORM スキーマ定義
- [ ] マイグレーション 001 実行（セッションテーブル追加）
- [ ] マイグレーション 002 実行（session_id 追加）
- [ ] 基本的な CRUD API 実装 (`/api/lt-sessions`)
- [ ] 型定義更新

#### 成果物

- 新しいデータベーススキーマ
- セッション管理 API
- 型定義ファイル更新

---

### **フェーズ 2: セッション管理機能（管理者用）**

**期間**: 1 週間
**担当**: フロントエンド

#### 作業内容

- [ ] 管理者ページに新タブ追加
- [ ] セッション一覧表示コンポーネント
- [ ] セッション作成・編集フォーム
- [ ] セッション削除機能（安全性確保）
- [ ] バリデーション実装（時間制限等）

#### 成果物

- セッション管理 UI
- CRUD 操作の完全実装

---

### **フェーズ 3: トーク投稿フォーム修正**

**期間**: 1 週間  
**担当**: フロントエンド

#### 作業内容

- [ ] `TalkForm.tsx`から venue 削除
- [ ] セッション選択ドロップダウン実装
- [ ] 利用可能セッション API (`/api/available-sessions`)
- [ ] 日付選択制限（セッションがある日のみ）
- [ ] 時間制限バリデーション（16:30-18:00）
- [ ] `EditableTalkCard.tsx` 修正

#### 成果物

- 更新されたトーク投稿フォーム
- セッションベースの投稿システム

---

### **フェーズ 4: スケジュール表示改善**

**期間**: 1 週間
**担当**: フロントエンド

#### 作業内容

- [ ] `SchedulePage.tsx` UI 改善
- [ ] 時間表示を左側に移動
- [ ] 第 ○ 回セッション情報表示
- [ ] venue 情報をセッションから取得
- [ ] `/api/daily-schedule` 修正（JOIN 対応）
- [ ] `/api/schedule-dates` 修正

#### 成果物

- 改善されたスケジュール表示
- セッション情報統合

---

### **フェーズ 5: テスト・最終調整**

**期間**: 1 週間
**担当**: 全体

#### 作業内容

- [ ] 統合テスト
- [ ] データ整合性確認
- [ ] UI/UX テスト
- [ ] パフォーマンステスト
- [ ] エラーハンドリング確認
- [ ] ドキュメント最終更新

#### 成果物

- 完全に動作するシステム
- テストレポート

---

### **フェーズ 6: クリーンアップ（オプション）**

**期間**: 数日
**担当**: バックエンド

#### 作業内容

- [ ] マイグレーション 003 実行（venue 削除）
- [ ] 不要なコード削除
- [ ] パフォーマンス最適化
- [ ] 最終ドキュメント更新

---

## 🚨 リスクと対策

### **高リスク項目**

1. **既存データの移行**

   - 対策: 十分なバックアップとロールバック計画
   - テスト環境での事前検証必須

2. **外部キー制約エラー**

   - 対策: 段階的マイグレーション
   - データ整合性チェック強化

3. **フロントエンドと API の同期**
   - 対策: API 仕様書の厳密な管理
   - モックサーバーでの先行開発

### **中リスク項目**

1. **時間制限バリデーション**

   - 対策: フロント・バックエンド両方でチェック
   - エラーメッセージの分かりやすさ確保

2. **管理者権限の管理**
   - 対策: 権限チェックの多層化
   - セキュリティテスト実施

---

## 📊 進捗管理

### **マイルストーン**

- [ ] **Week 1**: データベース基盤完成
- [ ] **Week 2**: セッション管理 UI 完成
- [ ] **Week 3**: フォーム修正完成
- [ ] **Week 4**: スケジュール改善完成
- [ ] **Week 5**: 全体テスト完了

### **成功基準**

1. 既存のトーク投稿機能が正常動作
2. 新しいセッション管理が完全動作
3. データ移行が 100%成功
4. パフォーマンスが劣化していない
5. ユーザビリティが向上している

---

## 🔧 開発環境準備

### **必要なツール**

- Drizzle Kit (マイグレーション生成)
- PostgreSQL (本番・開発環境)
- 適切な権限を持つデータベースユーザー

### **事前準備**

1. 本番データベースの完全バックアップ
2. ステージング環境の構築
3. マイグレーション実行手順書の作成

---

## 📞 緊急時対応

### **ロールバック手順**

1. アプリケーション停止
2. データベースバックアップからの復元
3. 旧バージョンのアプリケーション起動
4. データ整合性確認

### **連絡体制**

- 実装リーダー: [担当者名]
- データベース管理者: [担当者名]
- プロジェクトマネージャー: [担当者名]
