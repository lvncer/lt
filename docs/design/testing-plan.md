# テスト計画書

## 🧪 テスト戦略

### テストの目的

- 新機能（セッション管理）の正常動作確認
- 既存機能への影響がないことの確認
- データ移行の完全性確認
- パフォーマンス劣化の防止

---

## 📋 テスト項目

### **1. データベーステスト**

#### マイグレーションテスト

- [ ] セッションテーブル作成の成功
- [ ] 外部キー制約の正常動作
- [ ] 既存データの正常移行
- [ ] インデックスの作成確認

#### データ整合性テスト

- [ ] セッション削除時の talk.session_id NULL 設定
- [ ] 重複する session_number の防止
- [ ] 無効な session_id の検出

#### パフォーマンステスト

- [ ] JOIN クエリの実行時間測定
- [ ] インデックス効果の確認
- [ ] 大量データでの動作確認

---

### **2. API テスト**

#### 新規 API エンドポイント (`/api/lt-sessions`)

```bash
# GET /api/lt-sessions
curl -X GET "http://localhost:3000/api/lt-sessions"

# POST /api/lt-sessions
curl -X POST "http://localhost:3000/api/lt-sessions" \
  -H "Content-Type: application/json" \
  -d '{
    "session_number": 3,
    "date": "2024-03-15",
    "title": "春のLT大会",
    "venue": "さいたまIT・WEB専門学校 PBLルーム"
  }'

# PUT /api/lt-sessions
curl -X PUT "http://localhost:3000/api/lt-sessions" \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1,
    "session_number": 1,
    "title": "新年LT大会（更新）"
  }'

# DELETE /api/lt-sessions
curl -X DELETE "http://localhost:3000/api/lt-sessions?id=1"
```

#### 利用可能セッション API (`/api/available-sessions`)

```bash
# GET /api/available-sessions
curl -X GET "http://localhost:3000/api/available-sessions"
```

#### 修正された API

```bash
# GET /api/schedule-dates (セッションベース)
curl -X GET "http://localhost:3000/api/schedule-dates"

# GET /api/daily-schedule (JOIN確認)
curl -X GET "http://localhost:3000/api/daily-schedule?date=2024-01-15"
```

#### エラーケーステスト

- [ ] 存在しない session_id での投稿
- [ ] 重複する session_number での作成
- [ ] 時間制限外での投稿（16:30-18:00 外）
- [ ] 必須フィールドの欠如

---

### **3. フロントエンドテスト**

#### セッション管理 UI

- [ ] セッション一覧表示
- [ ] セッション作成フォーム
- [ ] セッション編集機能
- [ ] セッション削除（確認ダイアログ含む）
- [ ] 管理者権限チェック

#### トーク投稿フォーム

- [ ] セッション選択ドロップダウン
- [ ] 日付選択制限（セッションがある日のみ）
- [ ] 時間入力制限（16:30-18:00）
- [ ] venue 削除確認
- [ ] バリデーションメッセージ

#### スケジュール表示

- [ ] 第 ○ 回セッション情報表示
- [ ] 時間の左側表示
- [ ] venue 情報の正確な表示
- [ ] 時系列順の正しい表示

---

### **4. 統合テスト**

#### エンドツーエンドシナリオ

1. **セッション作成からトーク投稿まで**

   ```md
   1. 管理者がセッション作成
   2. ユーザーがそのセッションでトーク投稿
   3. 管理者がトークを承認
   4. スケジュールページで正しく表示
   ```

2. **既存データの移行確認**

   ```md
   1. マイグレーション前後のデータ比較
   2. 全てのトークがセッションに正しく紐付け
   3. スケジュール表示の一貫性
   ```

3. **セッション削除の安全性**

   ```md
   1. トークが紐付いているセッションの削除試行
   2. talk.session_id が null に正しく設定される
   3. スケジュール表示への影響確認
   ```

---

### **5. ユーザビリティテスト**

#### 管理者観点

- [ ] セッション管理の直感性
- [ ] エラーメッセージの分かりやすさ
- [ ] 操作の効率性

#### 投稿者観点

- [ ] セッション選択の分かりやすさ
- [ ] 時間制限の理解しやすさ
- [ ] エラー時の対処法の明確さ

#### 閲覧者観点

- [ ] スケジュールの見やすさ
- [ ] セッション情報の有用性
- [ ] 時間情報の分かりやすさ

---

## 🚨 テストデータ準備

### 必要なテストデータ

```sql
-- セッションデータ
INSERT INTO lt_sessions VALUES
(1, 1, '2024-01-15', '第1回 新年LT大会', 'さいたまIT・WEB専門学校 PBLルーム', '16:30', '18:00'),
(2, 2, '2024-02-15', '第2回 春のLT大会', 'さいたまIT・WEB専門学校 2階PC演習室', '16:30', '18:00'),
(3, 3, '2024-03-15', '第3回 新技術LT大会', 'さいたまIT・WEB専門学校 PBLルーム', '16:30', '18:00');

-- 関連するトークデータ
-- 既存のtalksテーブルのデータでsession_idを適切に設定
```

### テスト環境

- **開発環境**: ローカル開発用
- **ステージング環境**: 本番データのコピーで本格テスト
- **本番環境**: 最終確認

---

## 📊 テスト実行計画

### **Phase 1: 単体テスト**

**期間**: 2 日間

- データベース機能テスト
- API 単体テスト
- 各コンポーネント単体テスト

### **Phase 2: 統合テスト**

**期間**: 2 日間

- API 連携テスト
- データフロー確認
- エラーハンドリング確認

### **Phase 3: システムテスト**

**期間**: 2 日間

- エンドツーエンドテスト
- パフォーマンステスト
- セキュリティテスト

### **Phase 4: ユーザーアクセプタンステスト**

**期間**: 1 日間

- 実際のユーザーによるテスト
- フィードバック収集
- 最終調整

---

## ✅ 合格基準

### **必須項目（すべて満たす必要あり）**

- [ ] 全ての既存機能が正常動作
- [ ] データ移行が 100%成功
- [ ] 新機能が仕様通り動作
- [ ] セキュリティホールがない
- [ ] パフォーマンス劣化が 10%未満

### **推奨項目（80%以上満たすことが望ましい）**

- [ ] ユーザビリティが向上
- [ ] エラーメッセージが分かりやすい
- [ ] レスポンス時間が高速
- [ ] コードの可読性が高い
- [ ] ドキュメントが充実

---

## 🚨 テスト失敗時の対応

### **致命的エラー時**

1. 即座に開発停止
2. 原因調査・修正
3. 全テストの再実行

### **軽微なエラー時**

1. 優先度付けで対応順序決定
2. 修正後に関連テスト再実行
3. 影響範囲の再確認

### **ロールバック判断基準**

- データ損失の可能性
- 既存機能への重大な影響
- セキュリティリスクの発見
- 修正が予定期間を大幅に超過
